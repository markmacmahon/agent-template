# Shared Data Directory

This directory contains data files that are shared between the backend and frontend.

## OpenAPI Schema

The `openapi.json` file in this directory is:
- **Generated by**: Backend (`backend/commands/generate_openapi_schema.py`)
- **Consumed by**: Frontend OpenAPI client generator (`frontend/openapi-ts.config.ts`)
- **Regenerated**: Automatically on pre-commit and when backend schemas change

### Configuration

Both backend and frontend must point to the same location:

**Backend** (`backend/app/config.py`):
```python
OPENAPI_OUTPUT_FILE: str = "../local-shared-data/openapi.json"
```

**Frontend** (`frontend/.env.local`):
```bash
OPENAPI_OUTPUT_FILE=../local-shared-data/openapi.json
```

**Important**: Both paths are relative to their respective directories but resolve to the same file:
```
<project-root>/local-shared-data/openapi.json
```

### Workflow

1. Backend schemas change (in `backend/app/schemas.py` or `backend/app/models.py`)
2. Pre-commit hook runs `backend/commands/generate_openapi_schema.py`
3. OpenAPI schema is written to `local-shared-data/openapi.json`
4. Pre-commit hook runs frontend client generator
5. Frontend TypeScript client is regenerated from the schema

### Version Control

The `openapi.json` file is committed to the repository to ensure:
- CI/CD has a baseline schema to work from
- Pre-commit hooks can detect schema changes
- The frontend client is always in sync with the backend schema

The file is automatically regenerated when backend schemas change, and changes are committed along with the schema updates.

### Deployment (Vercel)

For Vercel deployments in a monorepo setup:

1. **GitHub Actions** generates the OpenAPI schema before deploying
   - Runs `backend/commands/generate_openapi_schema.py`
   - Outputs to `local-shared-data/openapi.json`

2. **Frontend prebuild** verifies the schema exists
   - Runs `frontend/scripts/check-openapi.js`
   - Regenerates TypeScript client from the schema

3. **Vercel build** proceeds with generated client
   - The entire repo is checked out by GitHub Actions
   - Frontend can access `../local-shared-data/openapi.json`

This ensures the frontend always has access to the latest backend schema, even in monorepo deployments where Vercel only deploys the frontend directory.
